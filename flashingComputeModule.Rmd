---
title: |
  ![](/Users/davidlapuma/Dropbox/CTT_Git/ctt_documentation/images/ctt_logo.png){width=3in}  
  <br />
  Flashing your SensorStation's Compute Module
author: "support@celltracktech.com"
date: "8/15/2024"
output:
  html_document:
    toc: yes
    number_sections: yes
  pdf_document:
    toc: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Updating your SensorStation's Disk Image

You can use your `CTT SensorStation` to burn a new operating system onto the compute module using a micro USB cable attached to your computer. Here is an article on raspbian's website with general instructions: [Flashing the Compute Module eMMC](https://www.raspberrypi.org/documentation/hardware/computemodule/cm-emmc-flashing.md). This page will summarize the steps needed to burn a New CTT SensorStation image to your compute module using the SensorStation hardware.

## Why flash my compute module? 

While CTT offers many over-the-air updates to your `CTT SensorStation` sometimes you just need a fresh start, or maybe you haven't been incrementally updating the source code and want to do so after a full stable release. You've found the right place to learn how!


***

## SensorStation Image Downloads

### **V1 SensorStation Current Stable Image**
*OTA Update enabled. Station health reports. RTL-SDR support. Pickup new Nodes / Tags with updated protocol.* 
[Download Station Image](https://d25eksygu9dzud.cloudfront.net/sensor-station/d7522108-017e-11ea-86b6-784f43a7974d/sensor-station.2020-03-23.zip)

### **V2 & V3 SensorStation Current Stable Image**
*Records Tag, GPS, SensorGnome, and Telemetry data. Monthly reboot on the 3rd of the month.* **Default radio firmware is v3.0.1 and is not compatible with CTT Node V3**

[Download Current Stable Disk Image](https://d25eksygu9dzud.cloudfront.net/sensor-station/images/sensor-station.latest.zip) (**Version ID: 2023-05-01 Updated: 2024-07-30**)

### **V2 & V3 SensorStation BETA Disk Image**
*This version is required if you are using the V3 version of the CTT Nodes, or the CTT BlūSeries Receiver.* **Note that you will also need to update your radio firmware to v4.0.0.** This is the default firmware for this disk image release. The radio firmware can now be updated directly from the LCD screen or the SensorStation Interface. See below for the `Changelog` and especially the `Unreleased` section for any known issues.

[Download BETA Disk Image](https://s3.amazonaws.com/media.celltracktech.com/sensor-station/images/sensor-station.beta.xz) (**Version ID: 2024-08-21 Updated 2024-08-21**)

**Note that once you update to the BETA Disk Image, in order to pick up V3 Nodes or BlūSeries tags, you will also need to update the radios on the SensorStation to V4.0.0 (the previous version was 3.0.1). You can do this via a push-button on the SensorStation interface, or via the LCD menu. Once you've done it, refresh your webpage and confirm that the five 434MHz radios are now reporting FW V4.0.0.**

### Changelong for BETA Disk Image ID: `2024-08-21 Updated 2024-08-21`

#### Added

### Changelog for BETA Disk Image ID: `2024-08-15 Updated 2024-08-15`

#### Added
- Point-to-Point connection is now "smart" and automatically searches for Ethernet with shared internet first, then Point-to-Point connection, and assigns IP accordingly

### Changelog for BETA Disk Image ID: `2024-07-16 Updated 2024-08-02`

#### Added
- BlūSeries code base
- detect 2.4 GHz Blū tags
- control individual Blū receivers and Blū radios
- Station stats menu
- Spanish LCD menu translation
- French LCD menu translation
- Portuguese LCD menu translation
- Dutch LCD menu translation
- Enable/disable options for WiFi on LCD interface
- Enable/disable options for cellular modem on LCD interface
- Option to program 434 radios to latest firmware (v4.0.0)
- Wifi and cellular modem signal strength on web interface
- Enable/disable options for WiFi and cellular modem on web interface
- Hide/display 434 radios, dongle radios, and Blū receivers
- Filter tag IDs across 434 and Blū radios

#### Changed
- Updated Node to v20.14.0
- Updated Linux kernel to v6.1.21-v7+
- Switched modem protocol from PPP to QMI
- Using ModemManager to manage and connect to cellular networks and to provide stats on connection
- Using NetworkManager rather than dhcpcd to connect and manage to WiFi/ethernet connections. 
- Add wifi credentials through USB with nmcli commands instead of modifying wpa_supplicant.conf
- Organized BlūSeries and Atmega32 directories within hardware/ctt directory
- Compatible with Node v3
- 434 and Blū tags detected by a Node appear in 434 tables configured for detecting Nodes
- 434 MHz radios upgraded to v4.0.0 firmware (previously v3.0.1)
- Dynamically add/remove USB radios

#### Removed
- Bookworm OS, currently using Bullseye v11

#### Fixed
- Station Update button on Web Interface

#### Unreleased
- **Point-to-Point connection**: Currently does not properly assign an IP address, making it impossible to connect a SensorStation directly to a computer via Ethernet. Connecting a SensorStation to a WiFi hotspot using the WiFi credentials, or connecting a SensorStation to an existing network device, such as a WiFi Router via Etherned does work.

***

## Software Requirements

You will need drivers for your computer to recognize the module as a new drive, and software to burn new images to disk.

### All Users

* All users require software to burn an image such as [Raspberry Pi Imager](https://www.raspberrypi.org/downloads/) or [balenaEtcher](https://www.balena.io/etcher/)

### Windows Drivers

* Drivers - Download and run the [Windows Installer](https://github.com/raspberrypi/usbboot/raw/master/win32/rpiboot_setup.exe) which will install the `rpiboot.exe`.

### Linux / Mac

Linux / MAC users will have to clone the rpiboot source code, compile and run the rpiboot.exe file that is generated. Detailed instructions for **Linux** [here](https://www.raspberrypi.org/documentation/hardware/computemodule/cm-emmc-flashing.md).

For **Mac**, follow these directions:

1. Install `Homebrew`, which is a package installer for **Mac**. 
    - Directions here: https://brew.sh <br>
    - Or you can paste this code into `Terminal`:

```
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install.sh)"
```


Then install the libusb libraries:

```
brew install libusb
```

2. From within Terminal, navigate to your preferred directory. 

*Tip: I tend to use Dropbox, so I use the `cd` command to **c**hange **d**irectory into my `Dropbox` folder: ```cd Dropbox```*

Once you are in your preferred directory, run the following code to install the USBBoot code in `Terminal`

```
git clone --depth=1 https://github.com/raspberrypi/usbboot
```

Then move into the `usbboot` directory:

```
cd usbboot
```

Now make the `rpiboot` installer:

```
make
```
At this point, you now have a standalone executable called `rpiboot` in the `usbboot` folder. You can move that executable anywhere you want so it's convenient for using again in the future.

Additionally, once you have moved the `rpiboot` executable, the `usbboot` folder can be trashed as its contents are only useful for making the `rpiboot` program. **From now on, if you need to flash more compute modules, you can start with running `rpiboot` and do not need to re-do steps 1 and 2 above.**

If you are still in the `usbboot` directory, you can now run run rpiboot with the following command. Otherwise use the `CD` command in `Terminal` to change directory to wherever you moved `rpiboot`.

```
./rpiboot
```

At this point you should see a message in your terminal that says something to the effect of: 

`Waiting for BCM2835/6/7/2711...`

This indicates that the USB port has been opened, and your computer is waiting to see a Raspberry Pi on that port. **Now complete Steps 1 and 2 below, and skip steps 3 and 4.**

***

## Steps to Burn a New Image

1. Ensure the SensorStation power is turned `OFF`
2. Move the **USB Boot Jumper Pin** to the `ENABLED` position (to the `left` 1 pin, for horizontally placed pins, or `down` 1 pin for vertically placed pins). 

* *Note: The location of your USB Boot Jumper may vary, and is typically vertically placed near the lower left corner of the Raspberry Pi module on V1 boards, or horizontally placed just above the power switch on V2 boards.*

![](/Users/davidlapuma/Dropbox/CTT_Git/ctt_documentation/images/boot_enabled2.png){#id .class width=25%}

3. Run `rpiboot.exe` which was installed from the previous step. From windows, you can search `rpiboot` to find it.

![](/Users/davidlapuma/Dropbox/CTT_Git/ctt_documentation/images/search_rpiboot.png){#id .class width=50%}

4. Running `rpiboot` will pop up a console showing a wait message waiting for the module to be detected: 

![](/Users/davidlapuma/Dropbox/CTT_Git/ctt_documentation/images/run-rpiboot.png){#id .class width=50%}

5. Plug the micro-USB cable into the SensorStation, and into your computer.
6. Power on the SensorStation.
7. The dialog box from `rpiboot` should disappear after displaying some messages and the module will be available as a new hard drive. (**Do not auto-fix as windows may suggest!**)
8. Run `Raspberry Pi Imager`

![](/Users/davidlapuma/Dropbox/CTT_Git/ctt_documentation/images/rpiimager.PNG){#id .class width=50%}

9. Click the button under `Operating System` and navigate to the SensorStation image file you saved (it's a `.zip` file), and select it.
10. Click the button under `SD Card` and select your Raspberry Pi compute module as the target. `example: RPi-MSGD- 0001 - 7.8 GB`
11. Click the `WRITE` button to flash the disk image.
  *   This will take a while, but once the image is written you will get a success message and the process is complete. 
12. Move the **USB Boot Jumper Pin** to the `DISABLED` position (to the `right` 1 pin, for horizontally placed pins, or `up` 1 pin for vertically placed pins). 
13. Restart your SensorStation and you're good to go!

*_Of course, as always, if you have any issue please don't hesitate to email us at support@celltracktech.com._*
